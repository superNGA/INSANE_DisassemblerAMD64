//=========================================================================
//                      EVEX Prefix
//=========================================================================
// by      : INSANE
// created : 29/01/2026
//
// purpose : Holds EVEX prefix and allows easy access to its components.
//-------------------------------------------------------------------------
#include "../../../Include/EVEX/EVEXPrefix_t.h"
#include <assert.h>
#include "../../../Include/Masks.h"
#include "../../Math/SafeBitWiseOps.h"
#include "../../Util/Terminal/Terminal.h"


using namespace InsaneDASM64;



///////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////
EVEX::EVEXPrefix_t::EVEXPrefix_t()
{
    Clear();
}


///////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////
void EVEX::EVEXPrefix_t::Clear()
{
    m_iPrefix   = 0x00;
    m_iPayload1 = 0x00;
    m_iPayload2 = 0x00;
    m_iPayload3 = 0x00;
}


///////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////
void EVEX::EVEXPrefix_t::StorePrefix(Byte iPrefix)
{
    m_iPrefix = iPrefix;
}


///////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////
void EVEX::EVEXPrefix_t::StorePayload(Byte iPayload, int iIndex)
{
    switch (iIndex) 
    {
        case 0: m_iPayload1 = iPayload; break;
        case 1: m_iPayload2 = iPayload; break;
        case 2: m_iPayload3 = iPayload; break;
                
        defaut:
                FAIL_LOG("Invalid Payload Index!");
                assert("Invalid Payload Index!"); 
                break;
    }
}


///////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////
uint64_t EVEX::EVEXPrefix_t::R() const
{
    return Maths::SafeAnd(m_iPayload1, EVEX::Masks::R) >> 7llu;
}


///////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////
uint64_t EVEX::EVEXPrefix_t::X() const
{
    return Maths::SafeAnd(m_iPayload1, EVEX::Masks::X) >> 6llu;
}


///////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////
uint64_t EVEX::EVEXPrefix_t::B() const
{
    return Maths::SafeAnd(m_iPayload1, EVEX::Masks::B) >> 5llu;
}


///////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////
uint64_t EVEX::EVEXPrefix_t::Rdash() const
{
    return Maths::SafeAnd(m_iPayload1, EVEX::Masks::R_DASH) >> 4llu;
}


///////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////
uint64_t EVEX::EVEXPrefix_t::mmm() const
{
    return Maths::SafeAnd(m_iPayload1, EVEX::Masks::MMM);
}


///////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////
uint64_t EVEX::EVEXPrefix_t::W() const
{
    return Maths::SafeAnd(m_iPayload2, EVEX::Masks::W) >> 7llu;
}


///////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////
uint64_t EVEX::EVEXPrefix_t::vvvv() const
{
    return Maths::SafeAnd(m_iPayload2, EVEX::Masks::VVVV) >> 3llu;
}


///////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////
uint64_t EVEX::EVEXPrefix_t::pp() const
{
    return Maths::SafeAnd(m_iPayload2, EVEX::Masks::PP);
}


///////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////
uint64_t EVEX::EVEXPrefix_t::z() const
{
    return Maths::SafeAnd(m_iPayload3, EVEX::Masks::Z) >> 7llu;
}


///////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////
uint64_t EVEX::EVEXPrefix_t::LL() const
{
    return Maths::SafeAnd(m_iPayload3, EVEX::Masks::LL) >> 5llu;
}


///////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////
uint64_t EVEX::EVEXPrefix_t::b() const
{
    return Maths::SafeAnd(m_iPayload3, EVEX::Masks::b) >> 4llu;
}


///////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////
uint64_t EVEX::EVEXPrefix_t::Vdash() const
{
    return Maths::SafeAnd(m_iPayload3, EVEX::Masks::V) >> 3llu;
}


///////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////
uint64_t EVEX::EVEXPrefix_t::aaa() const
{
    return Maths::SafeAnd(m_iPayload3, EVEX::Masks::AAA);
}    
